# 01.arch.structure - BigEyeMix 架构文档

> **文档版本**：v1.0.0
> **创建日期**：2025-01-15

---

## 📍 文档定位

本文档定义 BigEyeMix 项目的系统架构、数据流程和技术栈。

---

## 🏗️ 系统架构

```
用户访问 https://bem.it.sc.cn
         ↓
    Nginx (Port 80/443)
         ↓
    ┌────┴────┬────────┬────────┐
    ↓         ↓        ↓        ↓
  home/    muggle/  wizard/    api/
  (选择)   (麻瓜)   (巫师)  (后端)
                              ↓
                         PM2 + Python
                              ↓
                      音频处理服务
```

---

## 📁 目录结构

```
bem.it.sc.cn/
├── web/                    # 前端（静态文件）
│   ├── home/              # 首页（模式选择）
│   ├── muggle/            # 麻瓜模式
│   └── wizard/            # 巫师模式
├── api/                   # 后端（Python FastAPI）
│   ├── app/
│   │   ├── api/          # API 路由
│   │   ├── core/         # 核心配置
│   │   ├── models/       # 数据模型
│   │   └── services/     # 业务逻辑
│   ├── main.py
│   ├── uploads/          # 上传文件目录
│   └── outputs/          # 输出文件目录
└── deploy/               # 部署配置
```

---

## 🔄 路由映射

| 路径 | 目标 | 说明 |
|------|------|------|
| `/` | `web/home/` | 模式选择页面 |
| `/muggle` | `web/muggle/` | 麻瓜模式 |
| `/wizard` | `web/wizard/` | 巫师模式 |
| `/api` | `localhost:8000` | 后端 API |

---

## 📡 API 接口

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/upload` | POST | 上传音频文件 |
| `/api/mix` | POST | 混音处理 |
| `/api/download:id` | GET | 下载混音结果 |
| `/api/health` | GET | 健康检查 |
| `/api/docs` | GET | API 文档 |

---

## 🛠️ 技术栈

### 前端

| 组件 | 技术 | 说明 |
|------|------|------|
| 首页 | HTML + CSS | 模式选择界面 |
| 向导模式 | HTML + JavaScript + axios | 3步混音流程 |
| 专业模式 | AudioMass (待集成) | 基于 WaveSurfer.js |

### 后端

| 组件 | 技术 | 用途 |
|------|------|------|
| Web 框架 | FastAPI | REST API |
| ASGI 服务器 | Uvicorn | 运行 FastAPI |
| 音频分析 | librosa | 提取音频特征 |
| 音频处理 | pydub | 混音、剪辑、导出 |
| 音频编解码 | ffmpeg | pydub 依赖 |

### 基础设施

| 组件 | 技术 | 说明 |
|------|------|------|
| Web 服务器 | Nginx | 反向代理 + 静态文件 |
| 进程管理 | PM2 | 管理 Python 进程 |
| Python 版本 | 3.11 | 后端运行环境 |
| SSL 证书 | Let's Encrypt | HTTPS 支持 |

---

## 📊 数据流程

### 向导模式完整流程

```
用户操作                    前端                      后端
   │                        │                        │
   │ 1. 选择场景             │                        │
   ├───────────────────────>│                        │
   │                        │ 保存场景配置            │
   │                        │                        │
   │ 2. 上传音频             │                        │
   ├───────────────────────>│                        │
   │                        │ POST /api/upload       │
   │                        ├───────────────────────>│
   │                        │                        │ 保存 + 分析
   │                        │ 返回文件信息            │
   │                        │<───────────────────────┤
   │                        │                        │
   │ 3. 调整参数             │                        │
   ├───────────────────────>│ 更新过渡时长            │
   │                        │                        │
   │ 4. 开始混音             │                        │
   ├───────────────────────>│                        │
   │                        │ POST /api/mix          │
   │                        ├───────────────────────>│
   │                        │                        │ 处理混音
   │                        │ 返回 output_id         │
   │                        │<───────────────────────┤
   │                        │                        │
   │ 5. 下载结果             │                        │
   ├───────────────────────>│                        │
   │                        │ GET /api/download:id   │
   │                        ├───────────────────────>│
   │ 浏览器下载              │ 返回音频文件            │
   │<───────────────────────┤<───────────────────────┤
```

---

**最后更新**：2025-01-15
