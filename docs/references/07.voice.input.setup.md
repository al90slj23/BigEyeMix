# 语音输入功能配置指南

## 快速开始

语音输入功能已部署到生产环境，但需要配置腾讯云密钥才能正常使用。

## 配置步骤

### 1. 获取腾讯云密钥

1. 登录 [腾讯云控制台](https://console.cloud.tencent.com/)
2. 访问 [访问管理 - API密钥管理](https://console.cloud.tencent.com/cam/capi)
3. 点击"新建密钥"或查看现有密钥
4. 记录以下信息：
   - SecretId
   - SecretKey

### 2. 开通语音识别服务

1. 访问 [语音识别控制台](https://console.cloud.tencent.com/asr)
2. 开通"一句话识别"服务
3. 记录 AppId（在控制台首页可以看到）

### 3. 配置服务器环境变量

SSH 登录到服务器，编辑 `.env` 文件：

```bash
# 登录服务器
ssh root@bem.it.sc.cn

# 进入项目目录
cd /www/wwwroot/bem.it.sc.cn/api

# 编辑环境变量
vim .env
```

添加以下配置：

```bash
# 腾讯云语音识别配置
TENCENT_SECRET_ID=你的SecretId
TENCENT_SECRET_KEY=你的SecretKey
TENCENT_APP_ID=你的AppId
```

### 4. 重启服务

```bash
# 重启 PM2 服务
pm2 restart BigEyeMix-API --update-env

# 查看日志确认启动成功
pm2 logs BigEyeMix-API --lines 20
```

## 测试功能

### 1. 访问麻瓜模式

打开浏览器访问：https://bem.it.sc.cn/muggle

### 2. 上传音频文件

在第一步上传至少一个音频文件

### 3. 测试语音输入

1. 进入第二步编辑器
2. 切换到"麻瓜拼接"标签
3. 点击输入框右侧的麦克风按钮（红色）
4. 允许浏览器使用麦克风权限
5. 开始说话描述拼接需求，例如：
   - "我要第一个文件的前30秒，然后用淡化过渡连接第二个文件"
   - "知我 1分56到2分34 不要，剩下的加上春颂"
6. 再次点击麦克风按钮停止录音
7. 等待识别完成，文字会自动填入输入框
8. 点击"生成拼接方案"按钮

## 功能特性

### 录音控制

- **开始录音**：点击麦克风按钮，按钮变红色并显示脉冲动画
- **停止录音**：再次点击按钮，显示"正在识别..."
- **识别完成**：文字自动填入输入框

### 音频参数

- 采样率：16kHz
- 声道：单声道
- 格式：webm/ogg/mp4（自动选择）
- 大小限制：5MB

### 识别准确率

- 中文识别准确率：95%+
- 支持普通话、方言
- 自动过滤噪音和回声

## 故障排查

### 问题1：麦克风按钮无反应

**可能原因：**
- 浏览器不支持录音功能
- 未授予麦克风权限

**解决方案：**
- 使用 Chrome/Safari/Firefox 最新版本
- 检查浏览器设置，允许网站使用麦克风
- 确保使用 HTTPS 访问（HTTP 无法使用麦克风）

### 问题2：识别失败

**可能原因：**
- 未配置腾讯云密钥
- 密钥配置错误
- 网络连接问题
- 录音时间过短

**解决方案：**
```bash
# 检查环境变量
cd /www/wwwroot/bem.it.sc.cn/api
cat .env | grep TENCENT

# 查看后端日志
pm2 logs BigEyeMix-API --lines 50

# 重启服务
pm2 restart BigEyeMix-API --update-env
```

### 问题3：识别结果不准确

**可能原因：**
- 录音环境噪音过大
- 说话不清晰
- 方言口音较重

**解决方案：**
- 在安静环境录音
- 说话清晰、语速适中
- 使用普通话描述
- 录音后可以手动修改文字

## 成本估算

### 腾讯云语音识别定价

- 免费额度：每月 5000 次
- 超出后：0.0032 元/次（约 3.2 元/千次）

### 预估使用量

假设每天 100 个用户，每人使用 2 次：
- 每月使用量：100 × 2 × 30 = 6000 次
- 超出免费额度：1000 次
- 每月成本：1000 × 0.0032 = 3.2 元

## 安全建议

1. **密钥保护**
   - 不要将密钥提交到 Git
   - 定期更换密钥
   - 使用子账号密钥（限制权限）

2. **访问控制**
   - 限制 API 调用频率
   - 添加用户认证
   - 记录使用日志

3. **数据安全**
   - 录音数据不存储在服务器
   - 识别结果不记录
   - 使用 HTTPS 传输

## 监控和维护

### 查看服务状态

```bash
# 检查 PM2 进程
pm2 status

# 查看实时日志
pm2 logs BigEyeMix-API

# 查看错误日志
pm2 logs BigEyeMix-API --err
```

### 监控指标

- API 响应时间
- 识别成功率
- 错误日志
- 腾讯云用量

### 定期维护

- 每周检查日志
- 每月查看腾讯云账单
- 定期更新依赖包
- 备份配置文件

## 相关文档

- [语音输入功能文档](./06.voice.input.md)
- [腾讯云语音识别文档](https://cloud.tencent.com/document/product/1093)
- [部署指南](./02.deploy.guide.md)
