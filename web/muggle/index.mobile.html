<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BigEyeMix 麻瓜模式</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/wavesurfer.js@7"></script>
    <script src="https://unpkg.com/wavesurfer.js@7/dist/plugins/timeline.min.js"></script>
    <script src="https://unpkg.com/wavesurfer.js@7/dist/plugins/spectrogram.min.js"></script>
    <link rel="stylesheet" href="/muggle/Muggle.base.css?v=30">
    <link rel="stylesheet" href="/muggle/Muggle.upload.css?v=30">
    <link rel="stylesheet" href="/muggle/Muggle.editor.css?v=30">
    <link rel="stylesheet" href="/muggle/Muggle.timeline.css?v=30">
    <link rel="stylesheet" href="/muggle/Muggle.modal.css?v=30">
    <link rel="stylesheet" href="/muggle/Muggle.effects.css?v=30">
</head>
<body>
    <div class="container">
        <div class="top-nav">
            <div class="logo"><i data-lucide="eye"></i> BigEyeMix</div>
            <a href="/wizard/" class="mode-switch">巫师模式 <i data-lucide="arrow-right"></i></a>
        </div>

        <div class="progress-bar">
            <div class="progress-step active" data-step="1"></div>
            <div class="progress-step" data-step="2"></div>
            <div class="progress-step" data-step="3"></div>
        </div>

        <div class="step-indicator">
            <div class="step-number" id="stepNumber">1/3</div>
            <div class="step-title" id="stepTitle">上传音频</div>
            <div class="step-desc" id="stepDesc">选择要混合的音频文件</div>
        </div>

        <div class="content-card">
            <!-- Step 1: Upload -->
            <div class="step-content active" data-step="1">
                <div class="upload-list" id="uploadList"></div>
                <div class="add-upload-btn" id="addUploadBtn">
                    <i data-lucide="plus"></i> 添加更多音频
                </div>
            </div>

            <!-- Step 2: Editor & Timeline -->
            <div class="step-content" data-step="2">
                <div id="trackEditors"></div>
            </div>

            <!-- Step 3: Result -->
            <div class="step-content" data-step="3">
                <div id="processingView" class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">正在生成混音...</div>
                </div>
                <div id="resultView" class="result-section" style="display: none;">
                    <div class="result-icon"><i data-lucide="check-circle"></i></div>
                    <div class="result-title">混音完成！</div>
                    <div class="result-desc">你的音乐已经准备好了</div>
                    <button class="download-btn" id="downloadBtn">
                        <i data-lucide="download"></i> 下载混音文件
                    </button>
                    <button class="btn btn-secondary" onclick="location.reload()">
                        <i data-lucide="refresh-cw"></i> 重新开始
                    </button>
                </div>
            </div>

            <div class="button-group" id="buttonGroup">
                <button class="btn btn-secondary" id="prevBtn" onclick="prevStep()" style="display: none;">
                    <i data-lucide="arrow-left"></i> 上一步
                </button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextStep()" disabled>
                    下一步 <i data-lucide="arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal-overlay" id="historyModal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title" id="modalTitle">选择历史文件</span>
                <button class="modal-close" onclick="closeHistoryModal()"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- Custom Transition Modal -->
    <div class="modal-overlay" id="customTransitionModal">
        <div class="modal-content" style="max-width: 340px;">
            <div class="modal-header">
                <span class="modal-title">添加过渡</span>
                <button class="modal-close" onclick="closeCustomTransitionModal()"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <div style="margin-bottom: 16px;">
                    <label style="font-size: 13px; color: #666; display: block; margin-bottom: 8px;">过渡类型</label>
                    <div class="transition-type-selector" id="transitionTypeSelector">
                        <div class="transition-type-option selected" data-type="magicfill">
                            <i data-lucide="sparkles"></i>
                            <span>魔法填充</span>
                        </div>
                        <div class="transition-type-option" data-type="beatsync">
                            <i data-lucide="activity"></i>
                            <span>节拍对齐</span>
                        </div>
                        <div class="transition-type-option" data-type="crossfade">
                            <i data-lucide="git-merge"></i>
                            <span>淡出淡入</span>
                        </div>
                        <div class="transition-type-option" data-type="silence">
                            <i data-lucide="volume-x"></i>
                            <span>休止静音</span>
                        </div>
                    </div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="font-size: 13px; color: #666; display: block; margin-bottom: 8px;">过渡时长（秒）</label>
                    <input type="number" id="customTransitionInput" min="1" max="30" step="1" value="3" 
                           style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; text-align: center;">
                </div>
                <button onclick="addCustomTransition()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">
                    添加过渡块
                </button>
            </div>
        </div>
    </div>

    <!-- Color Picker Modal -->
    <div class="modal-overlay" id="colorPickerModal">
        <div class="modal-content" style="max-width: 320px;">
            <div class="modal-header">
                <span class="modal-title" id="colorPickerTitle">选择颜色</span>
                <button class="modal-close" onclick="closeColorPicker()"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <div class="color-picker-grid" id="colorPickerGrid"></div>
            </div>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div class="modal-overlay" id="confirmDeleteModal">
        <div class="modal-content confirm-modal">
            <div class="confirm-icon">
                <i data-lucide="alert-triangle"></i>
            </div>
            <div class="confirm-title" id="confirmDeleteTitle">确认删除？</div>
            <div class="confirm-desc" id="confirmDeleteDesc">此操作无法撤销</div>
            <div class="confirm-buttons">
                <button class="btn-cancel" onclick="closeConfirmDelete()">取消</button>
                <button class="btn-confirm" id="confirmDeleteBtn">删除</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="/muggle/Muggle.config.js?v=30"></script>
    <script src="/muggle/Muggle.utils.js?v=30"></script>
    <script src="/muggle/Muggle.upload.js?v=30"></script>
    <script src="/muggle/Muggle.history.js?v=30"></script>
    <script src="/muggle/Muggle.editor.js?v=30"></script>
    <script src="/muggle/Muggle.editor.clips.js?v=30"></script>
    <script src="/muggle/Muggle.timeline.js?v=30"></script>
    <script src="/muggle/Muggle.timeline.drag.js?v=30"></script>
    <script src="/muggle/Muggle.timeline.player.js?v=30"></script>
    <script src="/muggle/Muggle.timeline.preview.js?v=30"></script>
    <script src="/muggle/Muggle.timeline.magic.js?v=30"></script>
    <script src="/muggle/Muggle.logic.js?v=30"></script>
    <script>lucide.createIcons();</script>
</body>
</html>
